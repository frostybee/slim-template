# Nginx configuration for Slim Framework Template
#
# USAGE:
# 1. Copy this file to /etc/nginx/sites-available/your-project-name
# 2. Edit the values marked with [CHANGE THIS] to match your setup
# 3. Create a symlink: ln -s /etc/nginx/sites-available/your-project-name /etc/nginx/sites-enabled/
# 4. Test configuration: nginx -t
# 5. Reload Nginx: systemctl reload nginx

server {
    listen 80;
    listen [::]:80;

    # [CHANGE THIS] Your domain name or IP address if not running locally.
    server_name localhost;

    # [CHANGE THIS] Path to your project's public directory
    # IMPORTANT: Point directly to the public/ folder, NOT the project root
    root /var/www/your-project-name/public;

    index index.php;

    # Character encoding
    charset utf-8;

    # Logging
    access_log /var/log/nginx/slim-api.access.log;
    error_log /var/log/nginx/slim-api.error.log;

    # Security: Deny access to hidden files (except .well-known for SSL verification)
    location ~ /\.(?!well-known).* {
        deny all;
    }

    # Security: Deny access to sensitive files
    location ~ \.(htaccess|htpasswd|ini|log|sh|sql)$ {
        deny all;
    }

    # Main location block - Front Controller Pattern
    # All requests go to index.php unless the file exists
    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    # PHP-FPM Configuration
    location ~ \.php$ {
        # Check that the PHP file exists before passing to PHP-FPM
        try_files $uri =404;

        # FastCGI settings
        fastcgi_split_path_info ^(.+\.php)(/.+)$;

        # [CHANGE THIS] PHP-FPM socket path
        # Common options:
        # - Unix socket: unix:/var/run/php/php8.4-fpm.sock (recommended)
        # - TCP socket: 127.0.0.1:9000
        fastcgi_pass unix:/var/run/php/php8.4-fpm.sock;

        fastcgi_index index.php;

        # Include FastCGI parameters
        include fastcgi_params;

        # Set SCRIPT_FILENAME for PHP-FPM
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        fastcgi_param DOCUMENT_ROOT $realpath_root;

        # Pass request URI properly
        fastcgi_param PATH_INFO $fastcgi_path_info;

        # Performance tuning
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 16k;
        fastcgi_buffers 4 16k;
    }

}
